<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI è´¢åŠ¡åŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: #F7F8FA;
            color: #1F2D3D;
            min-height: 100vh;
        }
        .mobile-container {
            max-width: 430px;
            width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            background: #F7F8FA;
            display: flex;
            flex-direction: column;
        }
        .nav-bar {
            background: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 0 rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-title {
            font-size: 17px;
            font-weight: 600;
            color: #1F2D3D;
        }
        .nav-back-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #1F2D3D;
            cursor: pointer;
            padding: 4px 8px;
        }
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            scroll-behavior: smooth;
        }
        .message {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }
        .message.user { flex-direction: row-reverse; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #EB3223 0%, #FF6B6B 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .message.user .avatar {
            background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
        }
        .message-content {
            max-width: calc(100% - 46px);
        }
        .message-text {
            background: white;
            padding: 12px 16px;
            border-radius: 16px 16px 16px 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            font-size: 15px;
            line-height: 1.6;
            color: #1F2D3D;
        }
        .message.user .message-text {
            background: #EB3223;
            color: white;
            border-radius: 16px 16px 4px 16px;
        }
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .quick-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 20px;
            font-size: 13px;
            color: #1F2D3D;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quick-btn:hover {
            border-color: #EB3223;
            background: #FEF2F2;
        }
        .quick-btn.primary {
            background: #EB3223;
            color: white;
            border-color: #EB3223;
        }
        .quick-btn.primary:hover {
            background: #D72A1B;
        }
        .input-area {
            background: white;
            padding: 12px 16px;
            display: flex;
            gap: 12px;
            box-shadow: 0 -1px 0 rgba(0,0,0,0.05);
        }
        textarea {
            flex: 1;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 10px 12px;
            font-size: 15px;
            resize: none;
            max-height: 100px;
            min-height: 40px;
            font-family: inherit;
            line-height: 1.5;
        }
        textarea:focus { outline: none; border-color: #EB3223; }
        .send-btn {
            background: #EB3223;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #1F2D3D;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-size: 15px;
            background: white;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #EB3223;
        }
        .form-submit-btn {
            width: 100%;
            padding: 12px;
            background: #EB3223;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .data-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-top: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .data-card-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        .data-card-item:last-child {
            border-bottom: none;
        }
        .data-item-left {
            flex: 1;
        }
        .data-item-name {
            font-size: 15px;
            font-weight: 500;
            color: #1F2D3D;
            margin-bottom: 4px;
        }
        .data-item-detail {
            font-size: 13px;
            color: #8A8F99;
        }
        .data-item-right {
            text-align: right;
        }
        .data-item-amount {
            font-size: 16px;
            font-weight: 600;
            color: #EB3223;
        }
        .data-item-amount.income {
            color: #059669;
        }
        .data-item-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .action-link {
            font-size: 13px;
            cursor: pointer;
            color: #EB3223;
        }
        .action-link.delete {
            color: #8A8F99;
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="nav-bar">
            <button class="nav-back-btn" id="navBackBtn" onclick="goToIndex()" style="display: none;">â†</button>
            <div class="nav-title" id="navTitle">AI è´¢åŠ¡åŠ©æ‰‹</div>
            <button class="nav-back-btn" onclick="goToIndex()" title="è¿”å›é¦–é¡µ">ğŸ </button>
        </div>

        <div class="chat-container" id="chatContainer"></div>

        <div class="input-area">
            <textarea id="userInput" placeholder="è¾“å…¥é—®é¢˜æˆ–æŒ‡ä»¤..." rows="1"></textarea>
            <button class="send-btn" onclick="handleUserInput()">å‘é€</button>
        </div>
    </div>

    <script>
        // ===== æ•°æ®å­˜å‚¨ =====
        let loans = JSON.parse(localStorage.getItem('loans') || '[]');
        let incomes = JSON.parse(localStorage.getItem('incomes') || '[]');
        let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
        
        const platforms = ['Akulaku', 'Kredivo', 'AdaKami', 'Indodana', 'Shopee', 'Lazada', 'TOKOPEDIA'];
        
        // ===== åˆå§‹åŒ– =====
        window.onload = function() {
            showWelcome();
        };
        
        // ===== æ˜¾ç¤ºæ¬¢è¿è¯­ =====
        function showWelcome() {
            document.getElementById('navBackBtn').style.display = 'none';
            document.getElementById('navTitle').textContent = 'AI è´¢åŠ¡åŠ©æ‰‹';
            
            const welcomeHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>ç”¨ AI å¸®ä½ ç®¡ç†æ‰€æœ‰å€Ÿæ¬¾</strong><br><br>
                            æ•´åˆå¤šä¸ªå¹³å°çš„è´¦å•ä¿¡æ¯ï¼Œç”Ÿæˆæ¸…æ™°çš„åˆ†æä¸è¿˜æ¬¾è®¡åˆ’ã€‚<br><br>
                            æ”¯æŒå¤šä¸ªå€Ÿæ¬¾å¹³å°ï¼Œè‡ªåŠ¨è¯†åˆ«è´¦å•æˆªå›¾ï¼Œæ™ºèƒ½ç”Ÿæˆè¿˜æ¬¾å»ºè®®ã€‚
                        </div>
                        <div class="quick-replies">
                            <button class="quick-btn primary" onclick="showAddLoan()">æ·»åŠ è´·æ¬¾</button>
                            <button class="quick-btn" onclick="showIncomeList()">æ”¶å…¥ç®¡ç†</button>
                            <button class="quick-btn" onclick="showExpenseList()">æ”¯å‡ºç®¡ç†</button>
                            <button class="quick-btn" onclick="showAnalysis()">ç”Ÿæˆåˆ†ææŠ¥å‘Š</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML = welcomeHTML;
        }
        
        // ===== æ˜¾ç¤ºä¸»èœå• =====
        function showMainMenu() {
            showWelcome();
        }
        
        // ===== è¿”å›é¦–é¡µ =====
        function goToIndex() {
            window.location.href = 'index.html';
        }
        
        // ===== è¿”å›æ¬¢è¿é¡µ =====
        function goToWelcome() {
            window.location.href = 'index.html';
        }
        
        // ===== æ·»åŠ è´·æ¬¾åŠŸèƒ½ =====
        function showAddLoan() {
            addUserMessage('æ·»åŠ è´·æ¬¾');
            
            const formHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            è¯·å¡«å†™è´·æ¬¾ä¿¡æ¯ï¼š
                        </div>
                        <div class="data-card">
                            <div class="form-group">
                                <label class="form-label">å€Ÿæ¬¾å¹³å°</label>
                                <select class="form-select" id="loanPlatform">
                                    ${platforms.map(p => `<option value="${p}">${p}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">å€Ÿæ¬¾é‡‘é¢ (Rp)</label>
                                <input type="number" class="form-input" id="loanAmount" placeholder="ä¾‹å¦‚: 1000000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">æœˆåˆ©ç‡ (%)</label>
                                <input type="number" class="form-input" id="loanRate" placeholder="ä¾‹å¦‚: 2.5" step="0.1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">è¿˜æ¬¾æœŸé™ (æœˆ)</label>
                                <input type="number" class="form-input" id="loanMonths" placeholder="ä¾‹å¦‚: 6">
                            </div>
                            <div class="form-group">
                                <label class="form-label">è¿˜æ¬¾æ—¥æœŸ</label>
                                <input type="date" class="form-input" id="loanDate">
                            </div>
                            <button class="form-submit-btn" onclick="saveLoan()">ä¿å­˜è´·æ¬¾</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += formHTML;
            scrollToBottom();
        }
        
        function saveLoan() {
            const platform = document.getElementById('loanPlatform').value;
            const amount = parseFloat(document.getElementById('loanAmount').value);
            const rate = parseFloat(document.getElementById('loanRate').value);
            const months = parseInt(document.getElementById('loanMonths').value);
            const date = document.getElementById('loanDate').value;
            
            if (!amount || !rate || !months || !date) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }
            
            const monthlyPayment = (amount * (1 + rate / 100 * months) / months).toFixed(0);
            
            const loan = {
                id: Date.now(),
                platform,
                amount,
                rate,
                months,
                date,
                monthlyPayment,
                createdAt: new Date().toISOString()
            };
            
            loans.push(loan);
            localStorage.setItem('loans', JSON.stringify(loans));
            
            addAIMessage(`âœ… è´·æ¬¾ä¿¡æ¯å·²ä¿å­˜ï¼<br><br>
                å¹³å°: ${platform}<br>
                é‡‘é¢: Rp ${amount.toLocaleString()}<br>
                æœˆä¾›: Rp ${parseInt(monthlyPayment).toLocaleString()}`);
            
            setTimeout(() => {
                addAIMessage('ä¿å­˜æˆåŠŸï¼', true, [
                    { text: 'è¿”å›é¦–é¡µ', action: 'goToIndex()' },
                    { text: 'æ·»åŠ æ”¶å…¥', action: 'showIncomeList()' }
                ]);
            }, 1000);
        }
        
        // ===== æ”¶å…¥ç®¡ç†åŠŸèƒ½ =====
        function showIncomeList() {
            addUserMessage('æ”¶å…¥ç®¡ç†');
            
            const fixedIncomes = incomes.filter(i => i.type === 'fixed');
            const otherIncomes = incomes.filter(i => i.type === 'other');
            
            let incomeHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>ğŸ“Š æ”¶å…¥æ¦‚å†µ</strong><br>
                            å›ºå®šæ”¶å…¥: ${fixedIncomes.length} ç¬”<br>
                            å…¶ä»–æ”¶å…¥: ${otherIncomes.length} ç¬”
                        </div>
                        ${fixedIncomes.length > 0 ? `
                            <div class="data-card">
                                <strong>å›ºå®šæ”¶å…¥</strong>
                                ${fixedIncomes.map(i => `
                                    <div class="data-card-item">
                                        <div class="data-item-left">
                                            <div class="data-item-name">${i.source}</div>
                                            <div class="data-item-detail">${i.description || 'æ— å¤‡æ³¨'}</div>
                                        </div>
                                        <div class="data-item-right">
                                            <div class="data-item-amount income">Rp ${i.amount.toLocaleString()}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${otherIncomes.length > 0 ? `
                            <div class="data-card">
                                <strong>å…¶ä»–æ”¶å…¥</strong>
                                ${otherIncomes.map(i => `
                                    <div class="data-card-item">
                                        <div class="data-item-left">
                                            <div class="data-item-name">${i.source}</div>
                                            <div class="data-item-detail">${i.date || 'æ— æ—¥æœŸ'}</div>
                                        </div>
                                        <div class="data-item-right">
                                            <div class="data-item-amount income">Rp ${i.amount.toLocaleString()}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        <div class="quick-replies">
                            <button class="quick-btn primary" onclick="showAddIncome('fixed')">æ·»åŠ å›ºå®šæ”¶å…¥</button>
                            <button class="quick-btn" onclick="showAddIncome('other')">æ·»åŠ å…¶ä»–æ”¶å…¥</button>
                            <button class="quick-btn" onclick="showMainMenu()">è¿”å›</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += incomeHTML;
            scrollToBottom();
        }
        
        function showAddIncome(type) {
            const typeName = type === 'fixed' ? 'å›ºå®š' : 'å…¶ä»–';
            
            const formHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            æ·»åŠ ${typeName}æ”¶å…¥ï¼š
                        </div>
                        <div class="data-card">
                            <div class="form-group">
                                <label class="form-label">æ”¶å…¥æ¥æº</label>
                                <input type="text" class="form-input" id="incomeSource" placeholder="ä¾‹å¦‚: å·¥èµ„">
                            </div>
                            <div class="form-group">
                                <label class="form-label">é‡‘é¢ (Rp)</label>
                                <input type="number" class="form-input" id="incomeAmount" placeholder="ä¾‹å¦‚: 5000000">
                            </div>
                            ${type === 'other' ? `
                            <div class="form-group">
                                <label class="form-label">æ—¥æœŸ</label>
                                <input type="date" class="form-input" id="incomeDate">
                            </div>
                            ` : ''}
                            <div class="form-group">
                                <label class="form-label">å¤‡æ³¨</label>
                                <input type="text" class="form-input" id="incomeDesc" placeholder="é€‰å¡«">
                            </div>
                            <button class="form-submit-btn" onclick="saveIncome('${type}')">ä¿å­˜æ”¶å…¥</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += formHTML;
            scrollToBottom();
        }
        
        function saveIncome(type) {
            const source = document.getElementById('incomeSource').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            const desc = document.getElementById('incomeDesc').value;
            
            if (!source || !amount) {
                alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
                return;
            }
            
            const income = {
                id: Date.now(),
                type,
                source,
                amount,
                description: desc,
                date: type === 'other' ? document.getElementById('incomeDate').value : null,
                createdAt: new Date().toISOString()
            };
            
            incomes.push(income);
            localStorage.setItem('incomes', JSON.stringify(incomes));
            
            addAIMessage(`âœ… æ”¶å…¥å·²ä¿å­˜ï¼<br><br>
                æ¥æº: ${source}<br>
                é‡‘é¢: Rp ${amount.toLocaleString()}`);
            
            setTimeout(() => {
                addAIMessage('ä¿å­˜æˆåŠŸï¼', true, [
                    { text: 'è¿”å›é¦–é¡µ', action: 'goToIndex()' },
                    { text: 'æ·»åŠ æ”¯å‡º', action: 'showExpenseList()' }
                ]);
            }, 1000);
        }
        
        // ===== æ”¯å‡ºç®¡ç†åŠŸèƒ½ =====
        function showExpenseList() {
            addUserMessage('æ”¯å‡ºç®¡ç†');
            
            const fixedExpenses = expenses.filter(e => e.type === 'fixed');
            const largeExpenses = expenses.filter(e => e.type === 'large');
            
            let expenseHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>ğŸ“Š æ”¯å‡ºæ¦‚å†µ</strong><br>
                            å›ºå®šæ”¯å‡º: ${fixedExpenses.length} ç¬”<br>
                            å¤§é¢æ”¯å‡º: ${largeExpenses.length} ç¬”
                        </div>
                        ${fixedExpenses.length > 0 ? `
                            <div class="data-card">
                                <strong>å›ºå®šæ”¯å‡º</strong>
                                ${fixedExpenses.map(e => `
                                    <div class="data-card-item">
                                        <div class="data-item-left">
                                            <div class="data-item-name">${e.name}</div>
                                            <div class="data-item-detail">${e.description || 'æ— å¤‡æ³¨'}</div>
                                        </div>
                                        <div class="data-item-right">
                                            <div class="data-item-amount">Rp ${e.amount.toLocaleString()}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${largeExpenses.length > 0 ? `
                            <div class="data-card">
                                <strong>å¤§é¢æ”¯å‡º</strong>
                                ${largeExpenses.map(e => `
                                    <div class="data-card-item">
                                        <div class="data-item-left">
                                            <div class="data-item-name">${e.name}</div>
                                            <div class="data-item-detail">${e.date || 'æ— æ—¥æœŸ'}</div>
                                        </div>
                                        <div class="data-item-right">
                                            <div class="data-item-amount">Rp ${e.amount.toLocaleString()}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        <div class="quick-replies">
                            <button class="quick-btn primary" onclick="showAddExpense('fixed')">æ·»åŠ å›ºå®šæ”¯å‡º</button>
                            <button class="quick-btn" onclick="showAddExpense('large')">æ·»åŠ å¤§é¢æ”¯å‡º</button>
                            <button class="quick-btn" onclick="showMainMenu()">è¿”å›</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += expenseHTML;
            scrollToBottom();
        }
        
        function showAddExpense(type) {
            const typeName = type === 'fixed' ? 'å›ºå®š' : 'å¤§é¢';
            
            const formHTML = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">
                            æ·»åŠ ${typeName}æ”¯å‡ºï¼š
                        </div>
                        <div class="data-card">
                            <div class="form-group">
                                <label class="form-label">æ”¯å‡ºåç§°</label>
                                <input type="text" class="form-input" id="expenseName" placeholder="ä¾‹å¦‚: æˆ¿ç§Ÿ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">é‡‘é¢ (Rp)</label>
                                <input type="number" class="form-input" id="expenseAmount" placeholder="ä¾‹å¦‚: 2000000">
                            </div>
                            ${type === 'large' ? `
                            <div class="form-group">
                                <label class="form-label">æ—¥æœŸ</label>
                                <input type="date" class="form-input" id="expenseDate">
                            </div>
                            ` : ''}
                            <div class="form-group">
                                <label class="form-label">å¤‡æ³¨</label>
                                <input type="text" class="form-input" id="expenseDesc" placeholder="é€‰å¡«">
                            </div>
                            <button class="form-submit-btn" onclick="saveExpense('${type}')">ä¿å­˜æ”¯å‡º</button>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += formHTML;
            scrollToBottom();
        }
        
        function saveExpense(type) {
            const name = document.getElementById('expenseName').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const desc = document.getElementById('expenseDesc').value;
            
            if (!name || !amount) {
                alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
                return;
            }
            
            const expense = {
                id: Date.now(),
                type,
                name,
                amount,
                description: desc,
                date: type === 'large' ? document.getElementById('expenseDate').value : null,
                createdAt: new Date().toISOString()
            };
            
            expenses.push(expense);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            
            addAIMessage(`âœ… æ”¯å‡ºå·²ä¿å­˜ï¼<br><br>
                åç§°: ${name}<br>
                é‡‘é¢: Rp ${amount.toLocaleString()}`);
            
            setTimeout(() => {
                addAIMessage('ä¿å­˜æˆåŠŸï¼', true, [
                    { text: 'è¿”å›é¦–é¡µ', action: 'goToIndex()' },
                    { text: 'ç”ŸæˆæŠ¥å‘Š', action: 'showAnalysis()' }
                ]);
            }, 1000);
        }
        
        // ===== åˆ†ææŠ¥å‘ŠåŠŸèƒ½ =====
        function showAnalysis() {
            addUserMessage('ç”Ÿæˆåˆ†ææŠ¥å‘Š');
            addAIMessage('æ­£åœ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š...');
            
            setTimeout(() => {
                const totalIncome = incomes.reduce((sum, i) => sum + i.amount, 0);
                const totalExpense = expenses.reduce((sum, e) => sum + e.amount, 0);
                const totalLoan = loans.reduce((sum, l) => sum + l.amount, 0);
                const totalMonthlyPayment = loans.reduce((sum, l) => sum + parseFloat(l.monthlyPayment), 0);
                const balance = totalIncome - totalExpense - totalMonthlyPayment;
                const avgRate = loans.length > 0 ? (loans.reduce((sum, l) => sum + l.rate, 0) / loans.length).toFixed(2) : 0;
                
                const analysisHTML = `
                    <div class="message">
                        <div class="avatar">AI</div>
                        <div class="message-content">
                            <div class="message-text">
                                <strong>ğŸ“Š è´¢åŠ¡åˆ†ææŠ¥å‘Š</strong>
                            </div>
                            <div class="data-card">
                                <strong>æ”¶æ”¯åˆ†æ</strong>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">æ€»æ”¶å…¥</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div class="data-item-amount income">Rp ${totalIncome.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">æ€»æ”¯å‡º</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div class="data-item-amount">Rp ${totalExpense.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">è´·æ¬¾æ€»é¢</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div class="data-item-amount">Rp ${totalLoan.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">æœˆä¾›æ€»é¢</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div class="data-item-amount">Rp ${totalMonthlyPayment.toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">ç»“ä½™</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div class="data-item-amount ${balance >= 0 ? 'income' : ''}">Rp ${balance.toLocaleString()}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="data-card">
                                <strong>è´·æ¬¾åˆ†æ</strong>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">è´·æ¬¾ç¬”æ•°</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div>${loans.length} ç¬”</div>
                                    </div>
                                </div>
                                <div class="data-card-item">
                                    <div class="data-item-left">
                                        <div class="data-item-name">å¹³å‡åˆ©ç‡</div>
                                    </div>
                                    <div class="data-item-right">
                                        <div>${avgRate}%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="quick-replies">
                                <button class="quick-btn" onclick="goToIndex()">è¿”å›é¦–é¡µ</button>
                                <button class="quick-btn" onclick="showMainMenu()">è¿”å›ä¸»èœå•</button>
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('chatContainer').innerHTML += analysisHTML;
                scrollToBottom();
            }, 1500);
        }
        
        // ===== æ¶ˆæ¯è¾…åŠ©å‡½æ•° =====
        function addUserMessage(text) {
            const html = `
                <div class="message user">
                    <div class="avatar">æˆ‘</div>
                    <div class="message-content">
                        <div class="message-text">${text}</div>
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += html;
            scrollToBottom();
        }
        
        function addAIMessage(text, showActions = false, actions = []) {
            let actionHTML = '';
            if (showActions && actions.length > 0) {
                actionHTML = `<div class="quick-replies">
                    ${actions.map(a => `<button class="quick-btn" onclick="${a.action}">${a.text}</button>`).join('')}
                </div>`;
            }
            
            const html = `
                <div class="message">
                    <div class="avatar">AI</div>
                    <div class="message-content">
                        <div class="message-text">${text}</div>
                        ${actionHTML}
                    </div>
                </div>
            `;
            document.getElementById('chatContainer').innerHTML += html;
            scrollToBottom();
        }
        
        function scrollToBottom() {
            const container = document.getElementById('chatContainer');
            container.scrollTop = container.scrollHeight;
        }
        
        // ===== ç”¨æˆ·è¾“å…¥å¤„ç† =====
        function handleUserInput() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;
            
            addUserMessage(text);
            input.value = '';
            
            setTimeout(() => {
                const lowerText = text.toLowerCase();
                if (lowerText.includes('è´·æ¬¾') || lowerText.includes('å€Ÿæ¬¾')) {
                    showAddLoan();
                } else if (lowerText.includes('æ”¶å…¥')) {
                    showIncomeList();
                } else if (lowerText.includes('æ”¯å‡º')) {
                    showExpenseList();
                } else if (lowerText.includes('æŠ¥å‘Š') || lowerText.includes('åˆ†æ')) {
                    showAnalysis();
                } else if (lowerText.includes('èœå•') || lowerText.includes('è¿”å›')) {
                    showMainMenu();
                } else {
                    addAIMessage('æˆ‘ç†è§£æ‚¨çš„æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åŠŸèƒ½ç®¡ç†è´¢åŠ¡ï¼š', true, [
                        { text: 'æ·»åŠ è´·æ¬¾', action: 'showAddLoan()' },
                        { text: 'æ”¶å…¥ç®¡ç†', action: 'showIncomeList()' },
                        { text: 'æ”¯å‡ºç®¡ç†', action: 'showExpenseList()' },
                        { text: 'ç”ŸæˆæŠ¥å‘Š', action: 'showAnalysis()' }
                    ]);
                }
            }, 500);
        }
        
        // ===== äº‹ä»¶ç›‘å¬ =====
        const textarea = document.getElementById('userInput');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });
        
        textarea.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleUserInput();
            }
        });
    </script>
</body>
</html>
